import java.util.Random
/**
 * This is a Studio Modes rule which simulates a real dimmer 
 */

var Number percent = 0 
var Number people = 0



//Initail fake value for testing
rule "Set random number of people for Occupancy sensor"
when
    System started
then
    people = 4
    if (Studio_Ocp1.state instanceof DecimalType) people = Studio_Ocp1.state as DecimalType
    Studio_Ocp1.postUpdate(people)
end


//Setting Modes
rule "Studio ON Modes"
when
    Item Studio_Ocp1 changed from Studio_Ocp1.state = 0 to Studio_Ocp1.state <= 25
then
    Studio_Light.sendCommend(ON)
    // Studying Mode in Studio
    if ((Studio_modestring.state == "Study") || (Studio_modeimage == "books")) {
        percent = 70
        if (Studio_Light.state instanceof DecimalType) percent = Studio_Light.state as DecimalType
        postUpdate(Studio_Light, percent)
    } 

    // Lecture Mode in Studio
    if ((Studio_modestring.state == "Lecture") || (Studio_modeimage == "projector") || (Studio_Projector.state == ON)) {
        percent = 35
        if (Studio_Light.state instanceof DecimalType) percent = Studio_Light.state as DecimalType
        postUpdate(Studio_Light, percent)
    } 

    // Manual Mode in Studio
    else if Studio_Light received command {
        if ((receivedCommand == INCREASE) || (receivedCommand == DECREASE)) {
            percent = 0
            if (Studio_Light.state instanceof DecimalType) percent = Studio_Light.state as DecimalType

            if (receivedCommand == INCREASE) percent = percent + 5
            if (receivedCommand == DECREASE) percent = percent - 5

            if (percent < 0)   percent = 0
            if (percent > 100) percent = 100
            postUpdate(Studio_Light, percent)
        }
    }

end


rule "Studio OFF Modes"
when 
    Item Studio_Ocp1 changed to Studio_Ocp1.state = 0 
then
    Studio_Light.sendCommend(OFF)
end

